;(function(root,factory){if(typeof module==="object"&&module.exports){module.exports=factory()}else if(typeof define==="function"&&define.amd){define([],factory)}else{this.PointerTracker=this.PointerTracker||{};this.PointerTracker.utils=factory()}})(this,function(){"use strict";var undefined,eventsMap={click:"touchstart",mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"};function normalizeEvent(e){e=e||event;if(!e.preventDefault)e.preventDefault=function(){this.returnValue=false};if(!e.stopPropagation)e.stopPropagation=function(){this.cancelBubble=true};return e}var addEvent=function(){if(document.addEventListener){return function F(elem,type,callback){if(!elem){return}elem=typeof elem==="string"?$(elem):elem;callback=touchEventHandler(callback,type,elem);if(eventsMap[type])elem.addEventListener(eventsMap[type],callback,true);elem.addEventListener(type,callback,true)}}else{return function F(elem,type,callback){if(!elem)return;elem=typeof elem==="string"?$(elem):elem;elem.attachEvent("on"+type,function(e){e=normalizeEvent(e);return callback.call(e.target||e.srcElement,e)})}}}();var alreadyHandledByTouchEvent;function touchEventHandler(callback,type,elem){var touchevent=eventsMap[type];if(!touchevent)return callback;return function(event){var isTouchEvent=event.type===touchevent;if(alreadyHandledByTouchEvent&&!isTouchEvent){return alreadyHandledByTouchEvent=false}alreadyHandledByTouchEvent=isTouchEvent;return callback.call(this,event)}}function getRaf(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback,rate){window.setTimeout(callback,rate||1e3/60)}}return{on:addEvent,getRaf:getRaf}});(function(root,factory){if(typeof module==="object"&&module.exports){module.exports=factory()}else if(typeof define==="function"&&define.amd){define([],factory)}else{this.PointerTracker=this.PointerTracker||{};this.PointerTracker.EventEmmiter=factory()}})(this,function(){"use strict";var hasOwnProperty={}.hasOwnProperty,slice=[].slice;function EventEmmiter(){}EventEmmiter.mixin=function(obj){var proto=EventEmmiter.prototype;for(var attr in EventEmmiter.prototype){if(hasOwnProperty.call(proto,attr)){obj[attr]=proto[attr]}}};EventEmmiter.prototype={on:function(eventType,listener){this._events=this._events||{};this._events[eventType]=this._events[eventType]||[];this._events[eventType].push(listener)},once:function(eventType,listener){var self=this;function wrap(){listener.apply(null,arguments);self.off(eventType,listener)}wrap.fn=listener;return this.on(eventType,listener)},off:function(eventType,listener){this._events=this._events||{};if(!listener){delete this._events[eventType];return}else if(!this._events[eventType]){return}var listeners=this._events[eventType],i,l;for(i=0,l=listeners.length;i<l;i++){if(listener===listeners[i]||listener===listeners[i].fn){return!!listeners.splice(i,1)}}},emit:function(eventType){if(!this._events||!this._events[eventType]){return}var listeners=this._events[eventType],args=slice.call(arguments,1),i,l;for(i=0,l=listeners.length;i<l;i++){listeners[i].apply(null,args)}}};return EventEmmiter});(function(root,factory){if(typeof module==="object"&&module.exports){module.exports=factory(require("./utils",require("./eventEmmiter")))}else if(typeof define==="function"&&define.amd){define(["./utils","./eventEmitter"],factory)}else{var utils=this.PointerTracker.utils,EventEmmiter=this.PointerTracker.EventEmmiter;this.PointerTracker=factory(utils,EventEmmiter)}})(this,function($,EventEmmiter){"use strict";var MIN_SQR_DIST=4,isMobil=/mobil|android|ios/gi.test(navigator.userAgent),ticked=0,IS_ANDROID_2_3=/android 2\.\d/i.test(navigator.userAgent);function PointerTracker(elem,element){this._element=element;this._elem=elem;this._points={};this.lastClick=0;this._loop=bind(moveLoop,this);$.on(element,"mousedown",bind(onmousedown,this));$.on(element,"mousemove",bind(onmousemove,this));$.on(element,"mouseup",bind(onmouseup,this));$.on(element,"mouseout",bind(onmouseup,this))}EventEmmiter.mixin(PointerTracker.prototype);PointerTracker.prototype.translate=function(x,y){this.tx=-x;this.ty=-y};function onmousedown(event){if(IS_ANDROID_2_3&&(new Date).getTime()-this.lastClick<300){this.lastClick=(new Date).getTime();return}var isTouch=event.type==="touchstart";stopAndPrevent(event);event=getCorrectEvent(event);this._isMousedown=true;this._pos=getElementPosition(this._elem);var start=getPointerPosition(this,event);this._points={start:start,last:start,current:start,isTouch:isTouch};this.emit("down",this._points)}function onmouseup(event){stopAndPrevent(event);ticked++;this._isMousedown=false;if(!this.mousemove&&event.type==="touchend")this.emit("tap",this._points);event=getCorrectEvent(event);if(this.mousemove)this.emit("stop",this._points);this.emit("up",this._points);this.mousemove=false}function onmousemove(event){stopAndPrevent(event);if(!this._isMousedown){if(this.__ticked===ticked)ticked++;return}event=getCorrectEvent(event);this._points.current=getPointerPosition(this,event);if(this.mousemove||distanceSqr(this._points.start,this._points.current)>MIN_SQR_DIST){if(!this.mousemove){this.emit("start",this._points);this._points.last=this._points.start}this.mousemove=true;if(this.__ticked!==ticked){this.__ticked=ticked;this._loop()}}}function moveLoop(){if(this.__ticked===ticked){requestAnimationFrame(this._loop);this.emit("move",this._points);this._points.last=this._points.current}}var requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback,rate){window.setTimeout(callback,rate||1e3/60)}}();function getPointerPosition(element,event){var position={};position.x=event.pageX-element._pos.x||event.offsetX||0;position.y=event.pageY-element._pos.y||event.offsetY||0;position.x+=element.tx||0;position.y+=element.ty||0;return position}function getCorrectEvent(event){return event.touches&&event.touches.length?event.touches[0]:event}function stopAndPrevent(event){event.stopPropagation();if(!IS_ANDROID_2_3)event.preventDefault()}function bind(fn,context){return function(){fn.apply(context,arguments)}}function distanceSqr(p1,p2){var x=p1.x-p2.x,y=p1.y-p2.y;return x*x+y*y}function getOffsetSum(element){var curleft=0,curtop=0;if(element.offsetParent){do{curleft+=element.offsetLeft;curtop+=element.offsetTop;alert(element.tagName+", "+element.offsetLeft+", "+element.offsetTop)}while(element=element.offsetParent)}return{x:curleft,y:curtop}}function getOffsetRect(elem){var box=elem.getBoundingClientRect(),body=document.body,docElem=document.documentElement,scrollTop=window.pageYOffset||docElem.scrollTop||body.scrollTop,scrollLeft=window.pageXOffset||docElem.scrollLeft||body.scrollLeft,clientTop=docElem.clientTop||body.clientTop||0,clientLeft=docElem.clientLeft||body.clientLeft||0,top=box.top+scrollTop-clientTop,left=box.left+scrollLeft-clientLeft;return{x:~~left,y:~~top}}function getElementPosition(elem){if(elem.getBoundingClientRect)return getOffsetRect(elem);else return getOffsetSum(elem)}return PointerTracker});